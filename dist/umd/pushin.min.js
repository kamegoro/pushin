!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pushin={})}(this,(function(t){"use strict";const e=[768,1440,1920],s="data-pushin-layer-index";class i{constructor(t,e,s,i){this.element=t,this.index=e,this.scene=s,this.options=i;const n=this.getInpoints(this.element,this.index),o=this.getOutpoints(this.element,n[0]),r=this.getSpeed(this.element);this.originalScale=this.getElementScaleX(t),this.ref={inpoints:n,outpoints:o,speed:r},this.element.setAttribute("data-pushin-layer-index",this.index.toString()),this.element.setAttribute("tabindex","0"),this.params={inpoint:this.getInpoint(n),outpoint:this.getOutpoint(o),speed:r}}getInpoints(t,e){var s;let i=[this.scene.getTop()];if(t.dataset.pushinFrom)i=t.dataset.pushinFrom.split(",").map((t=>parseInt(t.trim(),10)));else if(null===(s=this.options)||void 0===s?void 0:s.inpoints)i=this.options.inpoints;else if(0===e)i=this.scene.getInpoints();else if(e>0){const{outpoint:t}=this.scene.layers[e-1].params;i=[t-this.scene.speedDelta]}return i}getOutpoints(t,e){var s;let i=[e+this.scene.layerDepth];if(t.dataset.pushinTo){i=t.dataset.pushinTo.split(",").map((t=>parseInt(t.trim(),10)))}else(null===(s=this.options)||void 0===s?void 0:s.outpoints)&&(i=this.options.outpoints);return i}getSpeed(t){var e;let s=null;return t.dataset.pushinSpeed?(s=parseInt(t.dataset.pushinSpeed,10),Number.isNaN(s)&&(s=8)):(null===(e=this.options)||void 0===e?void 0:e.speed)&&(s=this.options.speed),s||8}setZIndex(t){this.element.style.zIndex=(t-this.index).toString()}resetLayerParams(){this.params={inpoint:this.getInpoint(this.ref.inpoints),outpoint:this.getOutpoint(this.ref.outpoints),speed:this.ref.speed}}getElementScaleX(t){const e=window.getComputedStyle(t).getPropertyValue("transform");let s=1;if(e&&"none"!==e){const t=e.match(/[matrix|scale]\(([\d,.\s]+)/);if(t&&t[1]){const e=t[1].split(", ");s=parseFloat(e[0])}}return s}isActive(){const{inpoint:t}=this.params,{outpoint:e}=this.params;return this.scene.pushin.scrollY>=t&&this.scene.pushin.scrollY<=e}getInpoint(t){const{breakpoints:e}=this.scene.options;return t[this.scene.getBreakpointIndex(e)]||t[0]}getOutpoint(t){const{breakpoints:e}=this.scene.options;return t[this.scene.getBreakpointIndex(e)]||t[0]}getScaleValue(t){const e=(this.scene.pushin.scrollY-t.params.inpoint)*(Math.min(t.params.speed,100)/100)/100;return Math.max(t.originalScale+e,0)}setScale({style:t},e){const s=`scale(${e})`;t.webkitTransform=s,t.mozTransform=s,t.msTransform=s,t.oTransform=s,t.transform=s}setLayerStyle(){let t=0;const e=0===this.index,s=this.index+1===this.scene.layers.length,{inpoint:i}=this.params,{outpoint:n}=this.params;if(e&&this.scene.pushin.scrollY<i)t=1;else if(s&&this.scene.pushin.scrollY>n)t=1;else if(this.isActive()){this.setScale(this.element,this.getScaleValue(this));let o=Math.max(Math.min(this.scene.pushin.scrollY-i,this.scene.transitionLength),0)/this.scene.transitionLength;e&&(o=1);let r=Math.max(Math.min(n-this.scene.pushin.scrollY,this.scene.transitionLength),0)/this.scene.transitionLength;s&&(r=1),t=Math.min(o,r)}this.element.style.opacity=t.toString()}setLayerVisibility(){parseFloat(this.element.style.opacity)>.1?this.element.classList.add("pushin-layer--visible"):this.element.classList.remove("pushin-layer--visible")}}class n{constructor(t){var e,s,i;this.pushin=t;const n=this.pushin.container.querySelector(".pushin-scene");n?this.container=n:(this.container=document.createElement("div"),this.container.classList.add("pushin-scene"),this.container.innerHTML=this.pushin.container.innerHTML,this.pushin.container.innerHTML="",this.pushin.container.appendChild(this.container),this.pushin.cleanupFns.push((()=>{this.pushin.container.innerHTML=this.container.innerHTML}))),this.options=t.sceneOptions,this.speedDelta=(null===(e=this.options)||void 0===e?void 0:e.speedDelta)||100,this.layerDepth=(null===(s=this.options)||void 0===s?void 0:s.layerDepth)||1e3,this.transitionLength=(null===(i=this.options)||void 0===i?void 0:i.transitionLength)||200,this.layers=[],this.setBreakpoints(),this.getLayers()}setBreakpoints(){var t;0===(null===(t=this.options)||void 0===t?void 0:t.breakpoints.length)&&(this.options.breakpoints=[...e]),this.container.dataset.pushinBreakpoints&&(this.options.breakpoints=this.container.dataset.pushinBreakpoints.split(",").map((t=>parseInt(t.trim(),10)))),this.options.breakpoints.unshift(0)}getLayers(){var t;const e=Array.from(this.container.getElementsByClassName("pushin-layer"));for(let s=0;s<e.length;s++){const n=e[s];let o={};(null===(t=this.options)||void 0===t?void 0:t.layers)&&this.options.layers.length>s&&(o=this.options.layers[s]);const r=new i(n,s,this,o);this.layers.push(r),r.setZIndex(e.length)}}getBreakpointIndex(t){const e=t.reverse().findIndex((t=>t<=window.innerWidth));return-1===e?0:t.length-1-e}getTop(){return this.container.getBoundingClientRect().top}getInpoints(){var t,e;let s=[this.getTop()];if(this.container.dataset.pushinFrom){const t=this.container.dataset.pushinFrom;s.push(parseInt(t,10))}else(null===(e=null===(t=this.options)||void 0===t?void 0:t.inpoints)||void 0===e?void 0:e.length)>0&&(s=this.options.inpoints);return s}}class o{constructor(t,e){var s;this.container=t,this.scrollY=0,this.layers=[],this.lastAnimationFrameId=-1,this.cleanupFns=[],this.debug=null!==(s=null==e?void 0:e.debug)&&void 0!==s&&s,this.sceneOptions={breakpoints:[],inpoints:[]},(null==e?void 0:e.scene)&&Object.assign(this.sceneOptions,e.scene),(null==e?void 0:e.layers)&&Object.assign(this.sceneOptions,e.layers)}start(){this.scrollY=this.getScrollY(),this.debug&&this.showDebugger(),this.container?(this.scene=new n(this),this.setScrollLength(),"undefined"!=typeof window&&this.bindEvents(),this.toggleLayers()):console.error("No container element provided to pushIn.js. Effect will not be applied.")}destroy(){for(cancelAnimationFrame(this.lastAnimationFrameId);this.cleanupFns.length;)this.cleanupFns.pop()()}getScrollY(){return"undefined"!=typeof window?window.scrollY:0}bindEvents(){const t=()=>{var t;if(this.scrollY=this.getScrollY(),this.dolly(),this.pushinDebug){const e=null===(t=this.pushinDebug)||void 0===t?void 0:t.querySelector(".pushin-debug__content");e&&(e.textContent=`Scroll position: ${Math.round(this.scrollY)}px`)}};let e;window.addEventListener("scroll",t),this.cleanupFns.push((()=>window.removeEventListener("scroll",t)));const i=()=>{clearTimeout(e),e=window.setTimeout((()=>{this.scene.layers.forEach((t=>t.resetLayerParams())),this.setScrollLength(),this.toggleLayers()}),300)};window.addEventListener("resize",i),this.cleanupFns.push((()=>window.removeEventListener("resize",i)));window.addEventListener("focus",(t=>{const e=t.target;if("hasAttribute"in e&&e.hasAttribute(s)){const t=parseInt(e.getAttribute(s),10),i=this.scene.layers[t];i&&window.scrollTo(0,i.params.inpoint+i.scene.transitionLength)}}),!0)}dolly(){cancelAnimationFrame(this.lastAnimationFrameId),this.lastAnimationFrameId=requestAnimationFrame((()=>{this.toggleLayers()}))}toggleLayers(){this.scene.layers.forEach((t=>{t.setLayerStyle(),t.setLayerVisibility()}))}setScrollLength(){const t=getComputedStyle(this.container).height.replace("px",""),e=(this.scene.layers.length-1)*this.scene.speedDelta,s=this.scene.layers.length*(this.scene.layerDepth+this.scene.transitionLength);this.container.style.height=`${Math.max(parseFloat(t),s-e)}px`}showDebugger(){this.pushinDebug=document.createElement("div"),this.pushinDebug.classList.add("pushin-debug");const t=document.createElement("p");t.innerText="Pushin.js Debugger",t.classList.add("pushin-debug__title");const e=document.createElement("div");e.classList.add("pushin-debug__content"),e.innerText=`Scroll position: ${this.scrollY}px`,this.pushinDebug.appendChild(t),this.pushinDebug.appendChild(e),document.body.appendChild(this.pushinDebug)}}const r=t=>{const e=null!=t?t:{},s=document.querySelectorAll(".pushin"),i=[];for(const t of s){const s=new o(t,e);s.start(),i.push(s)}return i};"undefined"!=typeof window&&(window.pushInStart=r),t.PushIn=o,Object.defineProperty(t,"__esModule",{value:!0})}));
