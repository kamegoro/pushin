!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).pushin={})}(this,(function(t){"use strict";const i=[768,1440,1920],e="data-pushin-layer-index";class s{getStringOption(t,i=this.container){let e;const s=this.getAttributeName(t);if(null==i?void 0:i.hasAttribute(s))e=i.getAttribute(s);else if("string"==typeof this.settings[t])e=this.settings[t];else if("number"==typeof this.settings[t])e=this.settings[t].toString();else if(this.settings[t]){"[object Array]"===Object.prototype.toString.call(this.settings[t])&&(e=this.settings[t])}else e="";return"string"==typeof e&&e.includes(",")&&(e=e.split(",")),e}getNumberOption(t,i=this.container){let e=null;const s=this.getAttributeName(t);return(null==i?void 0:i.hasAttribute(s))?e=i.getAttribute(s):this.settings[t]&&(e=this.settings[t]),"string"==typeof e&&(e=e.split(",").map((t=>parseFloat(t))),e=e.length>1?e:e[0]),e}getBoolOption(t,i=this.container){let e=null;const s=this.getAttributeName(t);return(null==i?void 0:i.hasAttribute(s))?e=i.getAttribute(s):this.settings[t]&&(e=this.settings[t]),"string"==typeof e&&(e=e.split(",").map((t=>"false"!==t&&!!t)),e=e.length>1?e:e[0]),e}getAttributeName(t){return`data-pushin-${t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,((t,i)=>(i?"-":"")+t.toLowerCase()))}`}}class n extends s{constructor(t,i){super(),this.scene=t,this.options=i,this.settings=i}start(){this.setContainer(),this.container&&this.setRatio()}setContainer(){var t;const i=this.scene.container.querySelector(".pushin-composition");i?this.container=i:(null===(t=this.settings)||void 0===t?void 0:t.ratio)&&(this.container=document.createElement("div"),this.container.classList.add("pushin-composition"),this.container.innerHTML=this.scene.container.innerHTML,this.scene.container.innerHTML="",this.scene.container.appendChild(this.container),this.scene.pushin.cleanupFns.push((()=>{this.scene.container.innerHTML=this.container.innerHTML})))}setRatio(){let t=this.getNumberOption("ratio");if("number"==typeof t&&(t=[t,t]),t){const i=100*t.reduce(((t,i)=>i/t));this.container.style.paddingTop=`${i.toString()}%`}}}class o extends s{constructor(t,i,e,s){super(),this.container=t,this.index=i,this.scene=e,this.settings=s,this.isFirst=s.isFirst,this.isLast=s.isLast;const n=this.getInpoints(this.container,this.index),o=this.getOutpoints(this.container,n[0]),r=this.getSpeed(this.container),a=this.getTabInpoints(n);this.originalScale=this.getElementScaleX(this.container),this.ref={inpoints:n,outpoints:o,speed:r,tabInpoints:a},this.setA11y(),this.setLayerParams()}setA11y(){this.container.setAttribute("data-pushin-layer-index",this.index.toString()),this.container.setAttribute("tabindex","0"),this.container.setAttribute("aria-role","composite")}getTransitions(){var t,i;let e=null!==(i=null===(t=this.settings)||void 0===t?void 0:t.transitions)&&void 0!==i?i:"sequential"===this.scene.getMode();if(this.container.hasAttribute("data-pushin-transitions")){const t=this.container.dataset.pushinTransitions;t&&(e="false"!==t&&"0"!==t)}return e}getOverlap(){let t=0;if(this.index>0){const i=this.scene.layers[this.index-1],e=Math.max(0,i.params.transitionEnd),s=Math.max(0,this.getTransitionStart()),n=(s+e)/2;t=Math.min(.5*n,s)}return t}getTransitionStart(){const t=this.getTransitions();let i=this.getNumberOption("transitionStart");null!==i&&"number"!=typeof i&&([i]=i);let e=i;return e||t||"continuous"!==this.scene.getMode()?!e&&this.isFirst?e=-1:e||(e=200):e=-1,e}getTransitionEnd(){const t=this.getTransitions();let i=this.getNumberOption("transitionEnd");null!==i&&"number"!=typeof i&&([i]=i);let e=i;return e||t||"continuous"!==this.scene.getMode()?!e&&this.isLast?e=-1:e||(e=200):e=-1,e}getInpoints(t,i){var e;const{scene:s}=this;let n=[0];if(t.dataset.pushinFrom)n=t.dataset.pushinFrom.split(",").map((t=>parseInt(t.trim(),10)));else if(null===(e=this.settings)||void 0===e?void 0:e.inpoints)n=this.settings.inpoints;else if(this.isFirst||"continuous"===s.getMode())n=this.scene.getInpoints();else if(i>0){const{outpoint:t}=s.layers[i-1].params;n=[t-this.getOverlap()]}return n}getOutpoints(t,i){var e;let s=[i+this.scene.layerDepth];if(t.dataset.pushinTo){s=t.dataset.pushinTo.split(",").map((t=>parseInt(t.trim(),10)))}else(null===(e=this.settings)||void 0===e?void 0:e.outpoints)?s=this.settings.outpoints:"continuous"===this.scene.getMode()&&(s=[-1]);return s}getSpeed(t){var i;let e=null;return t.dataset.pushinSpeed?(e=parseFloat(t.dataset.pushinSpeed),Number.isNaN(e)&&(e=8)):(null===(i=this.settings)||void 0===i?void 0:i.speed)&&(e=this.settings.speed),e||8}setZIndex(t){this.container.style.zIndex=(t-this.index).toString()}setLayerParams(){this.params={depth:this.getDepth(),inpoint:this.getInpoint(this.ref.inpoints),outpoint:this.getOutpoint(this.ref.outpoints),tabInpoint:this.getTabInpoint(this.ref.tabInpoints),overlap:this.getOverlap(),speed:this.ref.speed,transitions:this.getTransitions(),transitionStart:this.getTransitionStart(),transitionEnd:this.getTransitionEnd()}}getDepth(){return this.getOutpoint(this.ref.outpoints)-this.getInpoint(this.ref.inpoints)}getElementScaleX(t){const i=window.getComputedStyle(t).getPropertyValue("transform");let e=1;if(i&&"none"!==i){const t=i.match(/[matrix|scale]\(([\d,.\s]+)/);if(t&&t[1]){const i=t[1].split(", ");e=parseFloat(i[0])}}return e}isActive(){const t=this.scene.pushin.scrollY>=this.params.inpoint,i=this.scene.pushin.scrollY<=this.params.outpoint;return t&&i}getInpoint(t){const{breakpoints:i}=this.scene.settings;return t[this.scene.getBreakpointIndex(i)]||t[0]}getOutpoint(t){const{breakpoints:i}=this.scene.settings;return t[this.scene.getBreakpointIndex(i)]||t[0]}getScaleValue(t){const i=(this.scene.pushin.scrollY-t.params.inpoint)*(Math.min(t.params.speed,100)/100)/100;return Math.max(t.originalScale+i,0)}setScale(t){const{style:i}=this.container,e=`scale(${t})`;i.webkitTransform=e,i.mozTransform=e,i.msTransform=e,i.oTransform=e,i.transform=e}setLayerStyle(){let t=0;const i=0===this.index,e=this.index+1===this.scene.layers.length,{inpoint:s}=this.params,{outpoint:n}=this.params;if(i&&this.scene.pushin.scrollY<s&&-1===this.params.transitionStart)t=1;else if(e&&this.scene.pushin.scrollY>n&&-1===this.params.transitionEnd)t=1;else if(this.isVisible()||this.isActive()){let i=Math.max(Math.min(this.scene.pushin.scrollY-s,this.params.transitionStart),0)/this.params.transitionStart;this.params.transitionStart<0&&(i=1);let e=Math.max(Math.min(n-this.scene.pushin.scrollY,this.params.transitionEnd),0)/this.params.transitionEnd;this.params.transitionEnd<0&&(e=1),t=this.params.transitions?Math.min(i,e):1}this.isActive()&&this.setScale(this.getScaleValue(this)),this.container.style.opacity=t.toString()}isVisible(){const{scrollY:t}=this.scene.pushin,{transitionStart:i,transitionEnd:e,transitions:s}=this.params;let n=!1;return s?(this.params.inpoint>t&&-1===i||this.params.outpoint<t&&-1===e||this.isActive())&&(n=!0):n=!0,n}setLayerVisibility(){parseFloat(this.container.style.opacity)>.1?this.container.classList.add("pushin-layer--visible"):this.container.classList.remove("pushin-layer--visible")}getTabInpoints(t){let i=this.getNumberOption("tabInpoints");return i||(i=t.map((t=>t+this.getTransitionStart()))),"number"==typeof i&&(i=[i]),i}getTabInpoint(t){const{breakpoints:i}=this.scene.settings;return t[this.scene.getBreakpointIndex(i)]||t[0]}}class r extends s{constructor(t){var i,e,s,n,o,r;super(),this.pushin=t;const a=null!==(e=null===(i=t.options)||void 0===i?void 0:i.scene)&&void 0!==e?e:{};this.settings={layerDepth:null==a?void 0:a.layerDepth,breakpoints:(null==a?void 0:a.breakpoints)||[],inpoints:(null==a?void 0:a.inpoints)||[],composition:null===(s=t.options)||void 0===s?void 0:s.composition,layers:(null===(n=t.options)||void 0===n?void 0:n.layers)||[],ratio:null==a?void 0:a.ratio,autoStart:null===(o=t.options)||void 0===o?void 0:o.autoStart,length:null===(r=this.pushin.options)||void 0===r?void 0:r.length},this.layers=[]}start(){this.setContainer(),this.setAutoStart(),this.setLayerDepth(),this.setSceneClasses(),this.setComposition(),this.setBreakpoints(),this.getLayers()}setContainer(){const t=this.pushin.container.querySelector(".pushin-scene");t?this.container=t:(this.container=document.createElement("div"),this.container.classList.add("pushin-scene"),this.container.innerHTML=this.pushin.container.innerHTML,this.pushin.container.innerHTML="",this.pushin.container.appendChild(this.container),this.pushin.cleanupFns.push((()=>{this.pushin.container.innerHTML=this.container.innerHTML})))}setAutoStart(){let t=this.getStringOption("autoStart",this.pushin.container);"screen-bottom"!==t&&"screen-top"!==t&&(t="scroll"),this.settings.autoStart=t}setLayerDepth(){var t;let i=this.getNumberOption("layerDepth");i||(i=this.getNumberOption("length",this.pushin.container)),i&&"number"!=typeof i&&([i]=i),this.layerDepth=null!==(t=i)&&void 0!==t?t:1e3}setComposition(){var t,i;const e={ratio:null!==(i=null===(t=this.pushin.settings.composition)||void 0===t?void 0:t.ratio)&&void 0!==i?i:void 0};this.composition=new n(this,e),this.composition.start()}setSceneClasses(){this.pushin.target&&this.container.classList.add("pushin-scene--with-target"),"window"===this.pushin.target.scrollTarget&&this.container.classList.add("pushin-scene--scroll-target-window")}resize(){var t;if("window"!==this.pushin.target.scrollTarget){const i=null===(t=this.pushin.target.container)||void 0===t?void 0:t.getBoundingClientRect();i&&(this.container.style.height=`${i.height}px`,this.container.style.width=`${i.width}px`)}this.updateOutpoints()}setBreakpoints(){var t,e;(null===(t=this.settings)||void 0===t?void 0:t.breakpoints)&&0!==(null===(e=this.settings)||void 0===e?void 0:e.breakpoints.length)||(this.settings.breakpoints=[...i]),this.container.dataset.pushinBreakpoints&&(this.settings.breakpoints=this.container.dataset.pushinBreakpoints.split(",").map((t=>parseInt(t.trim(),10)))),this.settings.breakpoints.unshift(0)}getLayers(){const t=Array.from(this.container.getElementsByClassName("pushin-layer"));this.layerCount=t.length,t.forEach(((i,e)=>{var s;let n={};(null===(s=null==this?void 0:this.settings)||void 0===s?void 0:s.layers)&&this.settings.layers[e]&&(n=this.settings.layers[e]),n.isFirst=0===e,n.isLast=e===t.length-1;const r=new o(i,e,this,n);this.layers.push(r),r.setZIndex(t.length)}))}getBreakpointIndex(t){const i=t.reverse().findIndex((t=>t<=window.innerWidth));return-1===i?0:t.length-1-i}getTop(){return this.container.getBoundingClientRect().top}getInpoints(){var t,i,e,s;let n=[0];if(this.container.dataset.pushinFrom){const t=this.container.dataset.pushinFrom;n.push(parseInt(t,10))}else(null===(t=this.settings)||void 0===t?void 0:t.inpoints)&&(null===(i=this.settings)||void 0===i?void 0:i.inpoints.length)>0?n=this.settings.inpoints:"screen-bottom"===(null===(e=this.settings)||void 0===e?void 0:e.autoStart)?n=[this.getTop()-window.innerHeight]:"screen-top"===(null===(s=this.settings)||void 0===s?void 0:s.autoStart)&&(n=[this.getTop()]);return n}getMode(){return this.pushin.mode}updateOutpoints(){"continuous"===this.getMode()&&this.layers.forEach((t=>{if(-1===t.params.outpoint){const{bottom:i}=this.pushin.container.getBoundingClientRect();t.params.outpoint=i}}))}}class a extends s{constructor(t,i){super(),this.pushin=t,this.settings=i,this.container=null,this.scrollTarget="window",this.height=0}start(){this.setTargetElement(),this.setScrollTarget(),this.setTargetHeight(),this.setTargetOverflow()}setTargetElement(){const t=this.getStringOption("target");if(t){const i=document.querySelector(t);i&&(this.container=i)}this.container&&this.pushin.container.parentElement!==this.container&&this.container.appendChild(this.pushin.container)}setScrollTarget(){const t=this.getStringOption("scrollTarget",this.pushin.container);let i;t&&"string"==typeof t&&(i="window"===t?t:document.querySelector(t)),!i&&this.container&&(i=this.container),i&&(this.scrollTarget=i)}setTargetHeight(){if(this.height=window.innerHeight,this.container){const t=getComputedStyle(this.container).height;this.height=+t.replace("px","")}}setTargetOverflow(){this.container&&"window"!==this.scrollTarget&&(this.container.style.overflowY="scroll",this.container.style.scrollBehavior="smooth")}}class h extends s{constructor(t,i={}){var e,s,n,o,r,a,h,l;super(),this.container=t,this.options=i,this.scrollY=0,this.lastAnimationFrameId=-1,this.cleanupFns=[],this.settings={debug:null!==(s=null===(e=this.options)||void 0===e?void 0:e.debug)&&void 0!==s&&s,target:null!==(o=null===(n=this.options)||void 0===n?void 0:n.target)&&void 0!==o?o:void 0,scrollTarget:null===(r=this.options)||void 0===r?void 0:r.scrollTarget,mode:null!==(h=null===(a=this.options)||void 0===a?void 0:a.mode)&&void 0!==h?h:"sequential"},this.settings.debug=null!==(l=null==i?void 0:i.debug)&&void 0!==l&&l}start(){this.container?(this.settings.debug&&this.showDebugger(),this.setMode(),this.loadStyles(),this.setTarget(),this.scrollY=this.getScrollY(),this.scene=new r(this),this.scene.start(),this.setScrollLength(),this.scene.resize(),"undefined"!=typeof window&&this.bindEvents(),this.toggleLayers()):console.error("No container element provided to pushIn.js. Effect will not be applied.")}setMode(){const t=this.getStringOption("mode");this.mode=""!==t?t:"sequential"}setTarget(){const t={};this.settings.target&&(t.target=this.settings.target),this.settings.scrollTarget&&(t.scrollTarget=this.settings.scrollTarget),this.target=new a(this,t),this.target.start()}destroy(){for(cancelAnimationFrame(this.lastAnimationFrameId);this.cleanupFns.length;)this.cleanupFns.pop()()}getScrollY(){var t;let i=0;if("window"===(null===(t=this.target)||void 0===t?void 0:t.scrollTarget)&&"undefined"!=typeof window)i=window.scrollY;else{i=this.target.scrollTarget.scrollTop}return i}bindEvents(){let t=window;"window"!==this.target.scrollTarget&&(t=this.target.scrollTarget);const i=()=>{var t;if(this.scrollY=this.getScrollY(),this.dolly(),this.pushinDebug){const i=null===(t=this.pushinDebug)||void 0===t?void 0:t.querySelector(".pushin-debug__content");i&&(i.textContent=`Scroll position: ${Math.round(this.scrollY)}px`)}};let s;t.addEventListener("scroll",i),this.cleanupFns.push((()=>t.removeEventListener("scroll",i)));const n=()=>{clearTimeout(s),s=window.setTimeout((()=>{this.scene.layers.forEach((t=>t.setLayerParams())),this.setScrollLength(),this.scene.resize(),this.toggleLayers()}),300)};window.addEventListener("resize",n),this.cleanupFns.push((()=>window.removeEventListener("resize",n)));window.addEventListener("focus",(i=>{const s=i.target;if("hasAttribute"in s&&s.hasAttribute(e)){const i=parseInt(s.getAttribute(e),10),n=this.scene.layers[i];if(n){let i=n.params.inpoint+n.params.transitionStart;if(n.params.tabInpoint&&(i=n.params.tabInpoint),"window"===this.target.scrollTarget)window.scrollTo(0,i);else{t.scrollTop=i}}}}),!0)}dolly(){cancelAnimationFrame(this.lastAnimationFrameId),this.lastAnimationFrameId=requestAnimationFrame((()=>{this.toggleLayers()}))}toggleLayers(){this.scene.layers.forEach((t=>{t.setLayerStyle(),t.setLayerVisibility()}))}setScrollLength(){var t,i;let e=this.scene.layerDepth;this.scene.layers.forEach((t=>{e=Math.max(e,t.params.outpoint)}));const s=null!==(i=null===(t=this.target)||void 0===t?void 0:t.height)&&void 0!==i?i:0,n=e+s,o=parseFloat(getComputedStyle(this.container).height.replace("px",""));let r=Math.max(o,n);n<window.innerHeight&&"continuous"===this.mode&&"screen-top"===this.scene.settings.autoStart&&(r+=window.innerHeight),this.container.style.height=`${r}px`}loadStyles(){if(!document.querySelector("style#pushin-styles")){const t=document.createElement("style");t.id="pushin-styles",t.appendChild(document.createTextNode(".pushin {position: relative;}.pushin-scene {display: flex;align-items: center;position: fixed;left: 0;top: 0;width: 100%;height: 100vh;}.pushin-scene--with-target {top: 0;left: auto;height: auto;width: auto;pointer-events: none;overflow: hidden;position: sticky;}.pushin-scene--scroll-target-window {height: 100vh;}.pushin-composition {flex: 0 0 100%;padding-top: 201%;position: relative;}.pushin-layer {display: flex;align-items: center;flex-direction: column;justify-content: center;opacity: 0;pointer-events: none;position: absolute;top: 0;right: 0;bottom: 0;left: 0;}.pushin-layer--visible * {pointer-events: auto;}.pushin-debug {background-color: white;border: 0;border-bottom: 1px;box-shadow: -2px 8px 19px 2px rgba(0, 0, 0, 0.26);padding: 1em;position: fixed;top: 0;width: 100%;-webkit-box-shadow: -2px 8px 19px 2px rgba(0, 0, 0, 0.26);z-index: 10;}@media (min-width: 768px) {.pushin-debug {border: 1px solid black;border-radius: 15px 0 0 15px;border-right: 0;right: 0;top: 50px;width: 250px;}}.pushin-debug__title {font-weight: bold;}")),document.head.appendChild(t),this.cleanupFns.push((()=>{document.head.removeChild(t)}))}}showDebugger(){var t,i;this.pushinDebug=document.createElement("div"),this.pushinDebug.classList.add("pushin-debug");const e=document.createElement("p");e.innerText="Pushin.js Debugger",e.classList.add("pushin-debug__title");const s=document.createElement("div");s.classList.add("pushin-debug__content"),s.innerText=`Scroll position: ${this.scrollY}px`,this.pushinDebug.appendChild(e),this.pushinDebug.appendChild(s);(null!==(i=null===(t=this.target)||void 0===t?void 0:t.container)&&void 0!==i?i:document.body).appendChild(this.pushinDebug),this.cleanupFns.push((()=>{var t;return null===(t=this.pushinDebug)||void 0===t?void 0:t.remove()}))}}const l=t=>{var i;const e=null!=t?t:{},s=null!==(i=null==t?void 0:t.selector)&&void 0!==i?i:".pushin",n=document.querySelectorAll(s),o=[];for(const t of n){const i=new h(t,e);i.start(),o.push(i)}return o};"undefined"!=typeof window&&(window.pushInStart=l),t.PushIn=h}));
