!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).pushin={})}(this,(function(t){"use strict";const i=[768,1440,1920],s="data-pushin-layer-index";class e{constructor(t,i){var s;this.scene=t,this.options=i,this.options=i;const e=this.scene.container.querySelector(".pushin-composition");e?this.container=e:(null===(s=this.options)||void 0===s?void 0:s.ratio)&&(this.container=document.createElement("div"),this.container.classList.add("pushin-composition"),this.container.innerHTML=this.scene.container.innerHTML,this.scene.container.innerHTML="",this.scene.container.appendChild(this.container),this.scene.pushin.cleanupFns.push((()=>{this.scene.container.innerHTML=this.container.innerHTML}))),this.container&&(this.getRatio(),this.setRatio())}getRatio(){var t;let i;if(this.container.hasAttribute("data-pushin-ratio")){const t=this.container.dataset.pushinRatio;i=null==t?void 0:t.split(",").map((t=>parseInt(t,10)))}else(null===(t=this.options)||void 0===t?void 0:t.ratio)&&(i=this.options.ratio);return i}setRatio(){var t;if(null===(t=this.options)||void 0===t?void 0:t.ratio){const t=100*this.options.ratio.reduce(((t,i)=>i/t));this.container.style.paddingTop=`${t.toString()}%`}}}class n{constructor(t,i,s,e){this.element=t,this.index=i,this.scene=s,this.options=e;const n=this.getInpoints(this.element,this.index),o=this.getOutpoints(this.element,n[0]),r=this.getSpeed(this.element);this.originalScale=this.getElementScaleX(t),this.ref={inpoints:n,outpoints:o,speed:r},this.element.setAttribute("data-pushin-layer-index",this.index.toString()),this.element.setAttribute("tabindex","0"),this.setLayerParams()}getTransitions(){var t,i;let s=null===(i=null===(t=this.options)||void 0===t?void 0:t.transitions)||void 0===i||i;if(this.element.hasAttribute("data-pushin-transitions")){const t=this.element.dataset.pushinTransitions;t&&(s="false"!==t&&"0"!==t)}return s}getOverlap(){let t=0;if(this.index>0){const i=this.scene.layers[this.index-1].params.transitionEnd,s=this.getTransitionStart(),e=(s+i)/2;t=Math.min(.5*e,s)}return t}getTransitionStart(){var t,i;let s=null!==(i=null===(t=this.options)||void 0===t?void 0:t.transitionStart)&&void 0!==i?i:200;if(this.element.hasAttribute("data-pushin-transition-start")){const t=this.element.dataset.pushinTransitionStart;s=parseInt(t,10)}return s}getTransitionEnd(){var t,i;let s=null!==(i=null===(t=this.options)||void 0===t?void 0:t.transitionEnd)&&void 0!==i?i:200;if(this.element.hasAttribute("data-pushin-transition-end")){const t=this.element.dataset.pushinTransitionEnd;s=parseInt(t,10)}return s}getInpoints(t,i){var s;let e=[this.scene.getTop()];if(t.dataset.pushinFrom)e=t.dataset.pushinFrom.split(",").map((t=>parseInt(t.trim(),10)));else if(null===(s=this.options)||void 0===s?void 0:s.inpoints)e=this.options.inpoints;else if(0===i)e=this.scene.getInpoints();else if(i>0){const{outpoint:t}=this.scene.layers[i-1].params;e=[t-this.getOverlap()]}return e}getOutpoints(t,i){var s;let e=[i+this.scene.layerDepth];if(t.dataset.pushinTo){e=t.dataset.pushinTo.split(",").map((t=>parseInt(t.trim(),10)))}else(null===(s=this.options)||void 0===s?void 0:s.outpoints)&&(e=this.options.outpoints);return e}getSpeed(t){var i;let s=null;return t.dataset.pushinSpeed?(s=parseFloat(t.dataset.pushinSpeed),Number.isNaN(s)&&(s=8)):(null===(i=this.options)||void 0===i?void 0:i.speed)&&(s=this.options.speed),s||8}setZIndex(t){this.element.style.zIndex=(t-this.index).toString()}setLayerParams(){this.params={depth:this.getDepth(),inpoint:this.getInpoint(this.ref.inpoints),outpoint:this.getOutpoint(this.ref.outpoints),overlap:this.getOverlap(),speed:this.ref.speed,transitions:this.getTransitions(),transitionStart:this.getTransitionStart(),transitionEnd:this.getTransitionEnd()}}getDepth(){return this.getOutpoint(this.ref.outpoints)-this.getInpoint(this.ref.inpoints)}getElementScaleX(t){const i=window.getComputedStyle(t).getPropertyValue("transform");let s=1;if(i&&"none"!==i){const t=i.match(/[matrix|scale]\(([\d,.\s]+)/);if(t&&t[1]){const i=t[1].split(", ");s=parseFloat(i[0])}}return s}isActive(){const{inpoint:t}=this.params,{outpoint:i}=this.params;let s=!0;if(this.params.transitions){const e=this.scene.pushin.scrollY>=t,n=this.scene.pushin.scrollY<=i;s=e&&n,(!s&&this.params.transitionStart<0&&!e||!s&&this.params.transitionEnd<0&&!n)&&(s=!0)}return s}getInpoint(t){const{breakpoints:i}=this.scene.options;return t[this.scene.getBreakpointIndex(i)]||t[0]}getOutpoint(t){const{breakpoints:i}=this.scene.options;return t[this.scene.getBreakpointIndex(i)]||t[0]}getScaleValue(t){const i=(this.scene.pushin.scrollY-t.params.inpoint)*(Math.min(t.params.speed,100)/100)/100;return Math.max(t.originalScale+i,0)}setScale({style:t},i){const s=`scale(${i})`;t.webkitTransform=s,t.mozTransform=s,t.msTransform=s,t.oTransform=s,t.transform=s}setLayerStyle(){let t=0;const i=0===this.index,s=this.index+1===this.scene.layers.length,{inpoint:e}=this.params,{outpoint:n}=this.params;if(i&&this.scene.pushin.scrollY<e)t=1;else if(s&&this.scene.pushin.scrollY>n)t=1;else if(this.isActive()){let o=Math.max(Math.min(this.scene.pushin.scrollY-e,this.params.transitionStart),0)/this.params.transitionStart;(i||this.params.transitionStart<0)&&(o=1);let r=Math.max(Math.min(n-this.scene.pushin.scrollY,this.params.transitionEnd),0)/this.params.transitionEnd;(s||this.params.transitionEnd<0)&&(r=1),t=this.params.transitions?Math.min(o,r):1}this.isActive()&&this.setScale(this.element,this.getScaleValue(this)),this.element.style.opacity=t.toString()}setLayerVisibility(){parseFloat(this.element.style.opacity)>.1?this.element.classList.add("pushin-layer--visible"):this.element.classList.remove("pushin-layer--visible")}}class o{constructor(t){var i,s,n;this.pushin=t;const o=this.pushin.container.querySelector(".pushin-scene");o?this.container=o:(this.container=document.createElement("div"),this.container.classList.add("pushin-scene"),this.container.innerHTML=this.pushin.container.innerHTML,this.pushin.container.innerHTML="",this.pushin.container.appendChild(this.container),this.pushin.cleanupFns.push((()=>{this.pushin.container.innerHTML=this.container.innerHTML}))),this.options=t.options.scene,this.layerDepth=(null===(i=this.options)||void 0===i?void 0:i.layerDepth)||1e3,this.layers=[],this.setSceneClasses();const r={ratio:null!==(n=null===(s=t.options.composition)||void 0===s?void 0:s.ratio)&&void 0!==n?n:void 0};this.composition=new e(this,r),this.setBreakpoints(),this.getLayers()}setSceneClasses(){this.pushin.target&&this.container.classList.add("pushin-scene--with-target"),"window"===this.pushin.scrollTarget&&this.container.classList.add("pushin-scene--scroll-target-window")}resize(){var t;if("window"!==this.pushin.scrollTarget){const i=null===(t=this.pushin.target)||void 0===t?void 0:t.getBoundingClientRect();i&&(this.container.style.height=`${i.height}px`,this.container.style.width=`${i.width}px`)}}setBreakpoints(){var t,s;(null===(t=this.options)||void 0===t?void 0:t.breakpoints)&&0!==(null===(s=this.options)||void 0===s?void 0:s.breakpoints.length)||(this.options.breakpoints=[...i]),this.container.dataset.pushinBreakpoints&&(this.options.breakpoints=this.container.dataset.pushinBreakpoints.split(",").map((t=>parseInt(t.trim(),10)))),this.options.breakpoints.unshift(0)}getLayers(){var t;const i=Array.from(this.container.getElementsByClassName("pushin-layer"));for(let s=0;s<i.length;s++){const e=i[s];let o={};(null===(t=this.options)||void 0===t?void 0:t.layers)&&this.options.layers.length>s&&(o=this.options.layers[s]);const r=new n(e,s,this,o);this.layers.push(r),r.setZIndex(i.length)}}getBreakpointIndex(t){const i=t.reverse().findIndex((t=>t<=window.innerWidth));return-1===i?0:t.length-1-i}getTop(){let{top:t}=this.container.getBoundingClientRect();return this.pushin.target&&(t-=this.pushin.target.getBoundingClientRect().top),t}getInpoints(){var t,i;let s=[this.getTop()];if(this.container.dataset.pushinFrom){const t=this.container.dataset.pushinFrom;s.push(parseInt(t,10))}else(null===(i=null===(t=this.options)||void 0===t?void 0:t.inpoints)||void 0===i?void 0:i.length)>0&&(s=this.options.inpoints);return s}}class r{constructor(t,i){var s,e,n,o,r,a;this.container=t,this.scrollY=0,this.lastAnimationFrameId=-1,this.cleanupFns=[],i=null!=i?i:{},this.options={debug:null!==(s=null==i?void 0:i.debug)&&void 0!==s&&s,scene:null!==(e=null==i?void 0:i.scene)&&void 0!==e?e:{breakpoints:[],inpoints:[]},target:null!==(n=null==i?void 0:i.target)&&void 0!==n?n:void 0,scrollTarget:null==i?void 0:i.scrollTarget},this.options.scene.composition=null!==(o=null==i?void 0:i.composition)&&void 0!==o?o:void 0,this.options.scene.layers=null!==(r=null==i?void 0:i.layers)&&void 0!==r?r:void 0,this.targetHeight=0,this.options.debug=null!==(a=null==i?void 0:i.debug)&&void 0!==a&&a}start(){this.container?(this.setTarget(),this.setScrollTarget(),this.setTargetHeight(),this.scrollY=this.getScrollY(),this.options.debug&&this.showDebugger(),this.scene=new o(this),this.setScrollLength(),this.setTargetOverflow(),this.scene.resize(),"undefined"!=typeof window&&this.bindEvents(),this.toggleLayers()):console.error("No container element provided to pushIn.js. Effect will not be applied.")}setTargetHeight(){if(this.targetHeight=window.innerHeight,this.target){const t=getComputedStyle(this.target).height;this.targetHeight=+t.replace("px","")}}setScrollTarget(){let t,i;this.container.hasAttribute("data-pushin-scroll-target")?i=this.container.dataset.pushinScrollTarget:this.options.scrollTarget&&(i=this.options.scrollTarget),i&&(t="window"===i?i:document.querySelector(i)),t||(t=this.target?this.target:"window"),this.scrollTarget=t}setTarget(){if(this.options.target&&(this.target=document.querySelector(this.options.target)),this.container.hasAttribute("data-pushin-target")){const t=this.container.dataset.pushinTarget;this.target=document.querySelector(t)}this.target&&this.container.parentElement!==this.target&&this.target.appendChild(this.container)}destroy(){for(cancelAnimationFrame(this.lastAnimationFrameId);this.cleanupFns.length;)this.cleanupFns.pop()()}getScrollY(){let t=0;if("window"===this.scrollTarget&&"undefined"!=typeof window)t=window.scrollY;else{const i=this.scrollTarget;i&&(t=i.scrollTop)}return t}setTargetOverflow(){this.target&&"window"!==this.scrollTarget&&(this.target.style.overflowY="scroll",this.target.style.scrollBehavior="smooth")}bindEvents(){const t="window"===this.scrollTarget?window:this.scrollTarget,i=()=>{var t;if(this.scrollY=this.getScrollY(),this.dolly(),this.pushinDebug){const i=null===(t=this.pushinDebug)||void 0===t?void 0:t.querySelector(".pushin-debug__content");i&&(i.textContent=`Scroll position: ${Math.round(this.scrollY)}px`)}};let e;t.addEventListener("scroll",i),this.cleanupFns.push((()=>t.removeEventListener("scroll",i)));const n=()=>{clearTimeout(e),e=window.setTimeout((()=>{this.scene.layers.forEach((t=>t.setLayerParams())),this.setScrollLength(),this.scene.resize(),this.toggleLayers()}),300)};window.addEventListener("resize",n),this.cleanupFns.push((()=>window.removeEventListener("resize",n)));window.addEventListener("focus",(i=>{const e=i.target;if("hasAttribute"in e&&e.hasAttribute(s)){const i=parseInt(e.getAttribute(s),10),n=this.scene.layers[i];if(n){const i=n.params.inpoint+n.params.transitionStart;if("window"===this.scrollTarget)window.scrollTo(0,i);else{t.scrollTop=i}}}}),!0)}dolly(){cancelAnimationFrame(this.lastAnimationFrameId),this.lastAnimationFrameId=requestAnimationFrame((()=>{this.toggleLayers()}))}toggleLayers(){this.scene.layers.forEach((t=>{t.setLayerStyle(),t.setLayerVisibility()}))}setScrollLength(){const t=getComputedStyle(this.container).height.replace("px","");let i=0;this.scene.layers.forEach((t=>{i=Math.max(i,t.params.outpoint)})),this.container.style.height=`${Math.max(parseFloat(t),i+this.targetHeight)}px`}showDebugger(){var t;this.pushinDebug=document.createElement("div"),this.pushinDebug.classList.add("pushin-debug");const i=document.createElement("p");i.innerText="Pushin.js Debugger",i.classList.add("pushin-debug__title");const s=document.createElement("div");s.classList.add("pushin-debug__content"),s.innerText=`Scroll position: ${this.scrollY}px`,this.pushinDebug.appendChild(i),this.pushinDebug.appendChild(s);(null!==(t=this.target)&&void 0!==t?t:document.body).appendChild(this.pushinDebug)}}const a=t=>{var i;const s=null!=t?t:{},e=null!==(i=null==t?void 0:t.selector)&&void 0!==i?i:".pushin",n=document.querySelectorAll(e),o=[];for(const t of n){const i=new r(t,s);i.start(),o.push(i)}return o};"undefined"!=typeof window&&(window.pushInStart=a),t.PushIn=r,Object.defineProperty(t,"__esModule",{value:!0})}));
